<!-- Backdrop -->
<div class="fixed inset-0 z-50 bg-black/40" (click)="cancel()"></div>

<!-- Modal container: centers panel and provides viewport-scoped scrolling -->
<div class="fixed inset-0 z-50 grid place-items-center p-4">
  <!-- Panel: max-h uses viewport minus 32px (top/bottom 16px each); overflow is managed inside -->
  <div
    class="w-full max-w-lg rounded-2xl bg-white shadow-xl ring-1 ring-slate-200 max-h-[calc(100vh-32px)] flex flex-col">
    <!-- Header: tighter padding -->
    <div class="border-b border-slate-200 px-5 py-4">
      <h2 class="text-lg font-semibold text-slate-900">Create a new project</h2>
    </div>

    <!-- Body: scrolls independently when content is taller -->
    <div class="px-5 py-4 overflow-y-auto">
      <!-- Name -->
      <label class="mb-1 block text-sm font-medium text-slate-700">Name</label>
      <input type="text"
        class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
        placeholder="E.g. My Awesome Project" [formControl]="form.controls.name" />

      <!-- Description -->
      <label class="mt-2 mb-1 block text-sm font-medium text-slate-700">Description</label>
      <textarea rows="3"
        class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
        placeholder="A short description of the project" [formControl]="form.controls.description"></textarea>

      <!-- Tags (comma separated) -->
      <label class="mt-2 mb-1 block text-sm font-medium text-slate-700">Tags</label>
      <input type="text"
        class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
        placeholder="e.g. ui, backend, urgent" [formControl]="form.controls.tagsInput"
        (keydown.enter)="$event.preventDefault(); addTagsFromInput()" (blur)="addTagsFromInput()" />
      <p class="mt-1 text-xs text-slate-500">Separate tags with commas. Press Enter to confirm.</p>
      <div class="mt-2 flex flex-wrap gap-2">
        <span *ngFor="let t of tags; let i = index"
          class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-sm text-slate-700">
          {{ t }}
          <button type="button" class="text-slate-500 hover:text-slate-700" (click)="removeTag(i)">×</button>
        </span>
      </div>

      <!-- Status -->
      <label class="mt-2 mb-1 block text-sm font-medium text-slate-700">Status</label>
      <select
        class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
        [formControl]="form.controls.status">
        <option *ngFor="let s of statuses" [ngValue]="s">{{ s }}</option>
      </select>

      <!-- Dates -->
      <div class="mt-2 grid gap-3 sm:grid-cols-2">
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-700">Start Date</label>
          <input type="date"
            class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
            [formControl]="form.controls.startDate" />
        </div>
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-700">End Date</label>
          <input type="date"
            class="w-full rounded-lg border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-violet-500"
            [formControl]="form.controls.endDate" />
        </div>
      </div>

      <!-- Members -->
      <!-- Members Multi-Select -->
      <label class="mt-2 mb-1 block text-sm font-medium text-slate-700">Members</label>

      <div class="max-h-60 overflow-auto border border-slate-300 rounded p-2">
        <ng-container *ngFor="let u of users">
          <label class="flex items-center gap-2 py-1">
            <input type="checkbox" (change)="onMemberToggle($event, u._id)"

              [checked]="members.includes(u._id)" class="form-checkbox h-4 w-4 text-violet-600" />
            <span>{{ u.name }} ({{ u.email }})</span>
          </label>
        </ng-container>
      </div>

      <!-- Selected members preview -->
      <p class="mt-1 text-xs text-slate-500">Selected members:</p>
      <div class="mt-2 flex flex-wrap gap-2">
        <span *ngFor="let m of members"
          class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-sm text-slate-700">
          {{ getUserNameById(m) }}
          <button type="button" class="text-slate-500 hover:text-slate-700" (click)="removeMember(m)">×</button>
        </span>
      </div>


      <!-- Footer: sticky inside panel, no scroll -->
      <div class="border-t border-slate-200 px-5 py-3 flex items-center justify-end gap-3">
        <button type="button" class="rounded-lg px-4 py-2 text-slate-700 hover:bg-slate-100"
          (click)="cancel()">Cancel</button>
        <button type="button" class="btn-brand" [disabled]="submitting || form.invalid" (click)="submit()">
          {{ submitting ? 'Creating...' : 'Create Project' }}
        </button>
      </div>
    </div>
  </div>
