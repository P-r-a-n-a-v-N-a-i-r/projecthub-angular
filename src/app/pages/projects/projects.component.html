<div class="mb-8 flex flex-wrap items-center justify-between gap-4">
  <div>
    <h1 class="text-3xl font-bold tracking-tight text-slate-900">All Projects</h1>
    <p class="mt-1 text-slate-500">Manage all your projects</p>
  </div>
  <button (click)="openCreate()" class="btn-brand">
    <lucide-icon name="plus" class="h-5 w-5"></lucide-icon>
    New Project
  </button>
</div>

<div *ngIf="loading" class="text-slate-500">Loading...</div>

<!-- Uniform Project Cards Grid -->
<div class="h-[70vh] overflow-y-auto">
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-x-10 gap-y-8 justify-start">
  <div *ngFor="let p of projects" (click)="onProjectClick(p)"
    class="w-full min-h-[220px] flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-7 shadow-sm transition hover:shadow-md cursor-pointer">
    <div>
      <div class="mb-3 flex items-center gap-2">
        <lucide-icon name="folder" class="h-6 w-6 text-slate-500"></lucide-icon>
        <span class="text-xl font-semibold text-slate-900">{{ p.name }}</span>
        <span class="ml-auto inline-block rounded-full px-3 py-1 text-xs font-bold ring-1 ring-inset"
          [ngClass]="getStatusClasses(p.status)">
          {{ p.status || 'in progress' }}
        </span>
      </div>

      <div class="mb-4 text-sm text-slate-500 line-clamp-2">
        {{ p.description || 'No description' }}
      </div>
    </div>
    <div class="flex flex-wrap items-center gap-6 text-xs text-slate-600 mt-auto">
      <div class="flex items-center gap-1">
        <lucide-icon name="user" class="h-4 w-4 text-slate-400"></lucide-icon>
        {{ getOwnerNameById(p.owner) || '-' }}
      </div>
      <div class="flex items-center gap-1">
        <lucide-icon name="calendar" class="h-4 w-4 text-slate-400"></lucide-icon>
        {{ (p.startDate || p.createdAt) | date: 'MMM d, y' }}
      </div>
      <div class="flex items-center gap-1">
        <lucide-icon name="check-square" class="h-4 w-4 text-slate-400"></lucide-icon>
        {{ projectStats[p._id]?.done || 0 }}/{{ projectStats[p._id]?.total || 0 }} tasks
      </div>
    </div>
  </div>
  <div *ngIf="showNotMemberDialog" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
      <p class="mb-4 text-lg text-slate-900">
        You are not a member of this project.
      </p>
      <p class="mb-6 text-slate-700">
        Please ask <strong>{{ notMemberOwnerName || 'the owner' }}</strong> to add you to this Project.
      </p>
      <button (click)="closeDialog()" class="btn-brand px-6 py-2 rounded">
        Close
      </button>
    </div>
  </div>
  
</div>
</div>

<app-create-project-modal *ngIf="showCreate" (closed)="onClosed($event)"></app-create-project-modal>
